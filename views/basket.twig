{% extends 'layouts/main.twig' %}
{% block title %}
    {% if user %}
        {{ user.name }} работа с корзиной
    {% else %}
        корзина
    {% endif %}
{% endblock %}
{% block header %}
    {% if user %}
        заказ пользователя {{ user.name }}
    {% else %}
        корзина
    {% endif %}
{% endblock %}
{% block content %}

    {% if is_auth %}
        {% if user_id == id_of_users_order or user_is_admin %}
            <h1>Товары в корзине</h1>
            <br>

            <div style="display: flex; flex-wrap: wrap; width: 900px;">
                {% for item in goods_in_basket %}
                    <div class="basket-php">
                        {% if item.img %}
                            <img src="/img/{{ item.img }}" alt="img" style="width: 200px; margin-bottom: 20px;">
                        {% else %}
                            <img src="/img/no_img.jpg" alt="img" style="width: 200px; margin-bottom: 20px;">
                        {% endif %}
                        <p style="text-align: center">
                            {{ item.name|length > 60 ? item.name|slice(0, 60) ~ '...' : item.name }}
                        </p>
                        <div>
                            <p>количество</p>
                            <div style="display: flex; width: 70px; justify-content: space-between">
                                <a href="/basket/minus?order={{ user.id }}&id={{ item.id }}">
                                    <i class="fas fa-minus"></i>
                                </a>
                                <p>{{ item.counter }}</p>
                                <a href="/basket/plus?order={{ user.id }}&id={{ item.id }}">
                                    <i class="fas fa-plus"></i>
                                </a>
                            </div>
                        </div>
                        <div style="display: flex">
                            <p style="margin-right: 6px;">стоимость:</p>
                            <p>{{ item.price }}&#8381;</p>
                        </div>
                        <a href="/basket/delFromBasket?order={{ user.id }}&id={{ item.id }}">
                            убрать из корзины
                        </a>
                    </div>
                {% else %}
                    <h3 style="color: red">Корзина пуста</h3>
                {% endfor %}
            </div>
            {% if goods_in_basket %}
                <div style="width: 500px; display: flex; justify-content: space-between">
                    <h1 style="color: purple">Общая сумма заказа: {{ total }}&#8381;</h1>
                    <a class="php-green-link php-other-link"
                       href="/order/createOrder?order={{ id_of_users_order }}">
                        оформить заказ
                    </a>
                </div>
            {% endif %}
            {% if user %}
                <br>
                <a class="php-other-link php-link"
                   href="/basket/orders"
                   style="width: 179px;">
                    назад к списку заказов
                </a>
            {% endif %}
        {% else %}
            <h3 style="color: red">Отказано в доступе</h3>
        {% endif %}
    {% else %}
        <h3 style="color: red">Необходима авторизация</h3>
    {% endif %}

{% endblock %}